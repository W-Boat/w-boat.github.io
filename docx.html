<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docx Forge Pro - 专业级文档合并工具</title>
    
    <!-- 外部资源库 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.4/dist/pizzip.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; -webkit-font-smoothing: antialiased; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .file-list-ghost { opacity: 0.4; background: #c7d2fe; border-style: dashed; }
        /* 自定义开关样式 */
        .toggle-checkbox:checked + .toggle-label { background-color: #4f46e5; }
        .toggle-checkbox:checked + .toggle-label .toggle-circle { transform: translateX(100%); }
    </style>
</head>
<body class="antialiased text-slate-700">

    <div class="container mx-auto max-w-3xl p-4 md:p-8">
        
        <header class="text-center mb-10">
            <h1 class="text-5xl md:text-6xl font-extrabold text-slate-800 tracking-tight">Docx Forge <span class="text-indigo-600">Pro</span></h1>
            <p class="mt-4 text-lg text-slate-600 max-w-2xl mx-auto">精炼、强大、优雅的在线文档合并工具。一切尽在您的浏览器中完成。</p>
        </header>

        <div class="p-4 mb-8 bg-sky-100 border-l-4 border-sky-500 text-sky-800 rounded-r-lg shadow-sm">
            <div class="flex items-center">
                <i data-lucide="chrome" class="h-6 w-6 mr-3 flex-shrink-0"></i>
                <p class="font-semibold">为了获得最佳性能和兼容性，强烈建议使用最新版本的 Google Chrome 浏览器。</p>
            </div>
        </div>

        <main class="space-y-8 bg-white p-6 md:p-10 rounded-2xl shadow-2xl fade-in-up">
            <!-- 步骤一: 上传 -->
            <div>
                <div class="flex items-center gap-4"><span class="flex items-center justify-center w-10 h-10 bg-indigo-600 text-white font-bold text-lg rounded-full">1</span><h2 class="text-2xl font-bold text-slate-800">上传并排序文件</h2></div>
                <div id="merge-drop-zone" class="mt-5 border-3 border-dashed border-slate-300 rounded-xl p-8 text-center cursor-pointer transition-all duration-300 hover:border-indigo-500 hover:bg-indigo-50">
                    <div class="pointer-events-none"><i data-lucide="file-up" class="mx-auto h-12 w-12 text-slate-400"></i><p class="mt-4 font-semibold text-slate-700">拖拽多个 DOCX 文件，或<span class="text-indigo-600">点击选择</span></p></div>
                </div>
                <input type="file" id="merge-file-input" class="hidden" multiple accept=".docx,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
            </div>

            <!-- 文件列表 -->
            <div id="merge-files-section" class="hidden">
                <div class="flex justify-between items-center"><h3 class="text-lg font-semibold text-slate-700">待合并文件列表 (可拖拽排序)</h3><button id="clear-all-btn" class="text-sm font-medium text-slate-500 hover:text-red-600 transition-colors flex items-center gap-1"><i data-lucide="trash-2" class="h-4 w-4"></i>清空</button></div>
                <div id="file-list" class="mt-4 max-h-80 overflow-y-auto pr-2 space-y-3"></div>
            </div>

            <!-- 步骤二: 设置 -->
            <div id="options-section" class="hidden border-t border-slate-200 pt-8">
                <div class="flex items-center gap-4"><span class="flex items-center justify-center w-10 h-10 bg-indigo-600 text-white font-bold text-lg rounded-full">2</span><h2 class="text-2xl font-bold text-slate-800">格式化选项</h2></div>
                <div class="mt-5 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 字体设置 -->
                    <div class="flex items-center justify-between bg-slate-50 p-4 rounded-lg">
                        <label for="font-toggle" class="font-semibold text-slate-700">设置字体为 "等线"</label>
                        <div class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="font-toggle" class="sr-only toggle-checkbox"><div class="toggle-label w-11 h-6 bg-slate-200 rounded-full transition-colors"><div class="toggle-circle w-5 h-5 bg-white rounded-full shadow-md transform transition-transform duration-300 ease-in-out"></div></div></div>
                    </div>
                    <!-- 行距设置 -->
                    <div class="flex items-center justify-between bg-slate-50 p-4 rounded-lg">
                        <label for="line-spacing-toggle" class="font-semibold text-slate-700">设置 0.25 倍行距 <span class="text-xs text-slate-500">(可能重叠)</span></label>
                        <div class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="line-spacing-toggle" class="sr-only toggle-checkbox"><div class="toggle-label w-11 h-6 bg-slate-200 rounded-full transition-colors"><div class="toggle-circle w-5 h-5 bg-white rounded-full shadow-md transform transition-transform duration-300 ease-in-out"></div></div></div>
                    </div>
                    <!-- 换行符清理 -->
                    <div class="flex items-center justify-between bg-slate-50 p-4 rounded-lg">
                        <label for="line-break-toggle" class="font-semibold text-slate-700">移除多余换行符</label>
                        <div class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="line-break-toggle" class="sr-only toggle-checkbox"><div class="toggle-label w-11 h-6 bg-slate-200 rounded-full transition-colors"><div class="toggle-circle w-5 h-5 bg-white rounded-full shadow-md transform transition-transform duration-300 ease-in-out"></div></div></div>
                    </div>
                    <!-- 分页符清理 -->
                    <div class="flex items-center justify-between bg-slate-50 p-4 rounded-lg">
                        <label for="page-break-toggle" class="font-semibold text-slate-700">移除所有分页符</label>
                        <div class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="page-break-toggle" class="sr-only toggle-checkbox"><div class="toggle-label w-11 h-6 bg-slate-200 rounded-full transition-colors"><div class="toggle-circle w-5 h-5 bg-white rounded-full shadow-md transform transition-transform duration-300 ease-in-out"></div></div></div>
                    </div>
                </div>
            </div>

            <!-- 步骤三: 执行 -->
            <div id="action-section" class="border-t border-slate-200 pt-8">
                <div class="flex items-center gap-4"><span class="flex items-center justify-center w-10 h-10 bg-indigo-600 text-white font-bold text-lg rounded-full">3</span><h2 class="text-2xl font-bold text-slate-800">生成并下载</h2></div>
                <div class="mt-5">
                    <label for="output-filename" class="block text-sm font-medium text-slate-700 mb-2">为合并后的文档命名:</label>
                    <input type="text" id="output-filename" class="w-full text-lg p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="例如: 合并后的项目报告.docx">
                </div>
                <div class="mt-6">
                    <button id="merge-button" disabled class="w-full flex items-center justify-center gap-3 bg-indigo-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg hover:bg-indigo-700 disabled:bg-slate-400 disabled:shadow-none disabled:cursor-not-allowed transition-all duration-300 active:scale-95"><i data-lucide="combine"></i><span id="merge-button-text">请先上传文件</span></button>
                    <p id="merge-error-message" class="text-red-500 text-sm mt-3 text-center h-4"></p>
                </div>
            </div>
        </main>
    </div>
    
    <script>
    // ====================================================================================
    // 内嵌的 `docx-merger` 库 (已修复 PizZip 的同步API不兼容问题)
    // ====================================================================================
    (function(window){'use strict';const JSZip=window.PizZip,DOMParser=window.DOMParser,XMLSerializer=window.XMLSerializer;const Style={};Style.prepareStyles=function(files,index){const zip=files[index],serializer=new XMLSerializer;let xmlString=zip.file("word/styles.xml").asText(),xml=new DOMParser().parseFromString(xmlString,'text/xml'),nodes=xml.getElementsByTagName('w:style');for(let i=0;i<nodes.length;i++){const node=nodes[i];if(node.getAttribute){const styleId=node.getAttribute('w:styleId');node.setAttribute('w:styleId',styleId+'_'+index);const basedonStyle=node.getElementsByTagName('w:basedOn')[0];basedonStyle&&basedonStyle.setAttribute('w:val',basedonStyle.getAttribute('w:val')+'_'+index);const w_next=node.getElementsByTagName('w:next')[0];w_next&&w_next.setAttribute('w:val',w_next.getAttribute('w:val')+'_'+index);const w_link=node.getElementsByTagName('w:link')[0];w_link&&w_link.setAttribute('w:val',w_link.getAttribute('w:val')+'_'+index);const numId=node.getElementsByTagName('w:numId')[0];numId&&numId.setAttribute('w:val',numId.getAttribute('w:val')+index),Style.updateStyleRel_Content(zip,index,styleId)}}const startIndex=xmlString.indexOf("<w:styles ");xmlString=xmlString.replace(xmlString.slice(startIndex),serializer.serializeToString(xml.documentElement)),zip.file("word/styles.xml",xmlString)},Style.mergeStyles=function(files,_styles){files.forEach(zip=>{let xmlString=zip.file("word/styles.xml").asText();xmlString=xmlString.substring(xmlString.indexOf("<w:style "),xmlString.indexOf("</w:styles")),_styles.push(xmlString)})},Style.updateStyleRel_Content=function(zip,fileIndex,styleId){let xmlString=zip.file("word/document.xml").asText();xmlString=xmlString.replace(new RegExp('w:val="'+styleId+'"','g'),'w:val="'+styleId+'_'+fileIndex+'"'),zip.file("word/document.xml",xmlString)},Style.generateStyles=function(zip,_style){let xmlString=zip.file("word/styles.xml").asText();const startIndex=xmlString.indexOf("<w:style "),endIndex=xmlString.indexOf("</w:styles>");xmlString=xmlString.replace(xmlString.slice(startIndex,endIndex),_style.join('')),zip.file("word/styles.xml",xmlString)};const RelContentType={};RelContentType.mergeContentTypes=function(files,_contentTypes){files.forEach(zip=>{const xmlString=zip.file("[Content_Types].xml").asText(),xml=new DOMParser().parseFromString(xmlString,'text/xml'),childNodes=xml.getElementsByTagName('Types')[0].childNodes;for(let i=0;i<childNodes.length;i++){const node=childNodes[i];if(node.getAttribute){const contentType=node.getAttribute('ContentType');_contentTypes[contentType]||(_contentTypes[contentType]=node.cloneNode())}}})},RelContentType.mergeRelations=function(files,_rel){files.forEach(zip=>{const relsFile=zip.file("word/_rels/document.xml.rels");if(!relsFile)return;const xmlString=relsFile.asText(),xml=new DOMParser().parseFromString(xmlString,'text/xml'),childNodes=xml.getElementsByTagName('Relationships')[0].childNodes;for(let i=0;i<childNodes.length;i++){const node=childNodes[i];if(node.getAttribute){const Id=node.getAttribute('Id');_rel[Id]||(_rel[Id]=node.cloneNode())}}})},RelContentType.generateContentTypes=function(zip,_contentTypes){let xmlString=zip.file("[Content_Types].xml").asText();const xml=new DOMParser().parseFromString(xmlString,'text/xml'),serializer=new XMLSerializer,types=xml.documentElement.cloneNode();for(const node in _contentTypes)types.appendChild(_contentTypes[node]);const startIndex=xmlString.indexOf("<Types");xmlString=xmlString.replace(xmlString.slice(startIndex),serializer.serializeToString(types)),zip.file("[Content_Types].xml",xmlString)},RelContentType.generateRelations=function(zip,_rel){const relsFile=zip.file("word/_rels/document.xml.rels");if(!relsFile)return;let xmlString=relsFile.asText();const xml=new DOMParser().parseFromString(xmlString,'text/xml'),serializer=new XMLSerializer,types=xml.documentElement.cloneNode();for(const node in _rel)types.appendChild(_rel[node]);const startIndex=xmlString.indexOf("<Relationships");xmlString=xmlString.replace(xmlString.slice(startIndex),serializer.serializeToString(types)),zip.file("word/_rels/document.xml.rels",xmlString)};const Media={};Media.prepareMediaFiles=function(files,media){let count=1;files.forEach((zip,index)=>{const medFiles=zip.folder("word/media").files;for(const mfile in medFiles)/^word\/media/.test(mfile)&&mfile.length>11&&(media[count]={oldTarget:mfile,newTarget:mfile.replace(/[0-9]/,'_'+count).replace('word/',""),fileIndex:index},Media.updateMediaRelations(zip,count,media),Media.updateMediaContent(zip,count,media),count++)})},Media.updateMediaRelations=function(zip,count,_media){const relsFile=zip.file("word/_rels/document.xml.rels");if(!relsFile)return;let xmlString=relsFile.asText(),xml=new DOMParser().parseFromString(xmlString,'text/xml');const childNodes=xml.getElementsByTagName('Relationships')[0].childNodes,serializer=new XMLSerializer;for(let i=0;i<childNodes.length;i++){const node=childNodes[i];if(node.getAttribute){const target=node.getAttribute('Target');'word/'+target===_media[count].oldTarget&&(_media[count].oldRelID=node.getAttribute('Id'),node.setAttribute('Target',_media[count].newTarget),node.setAttribute('Id',_media[count].oldRelID+'_'+count))}}const startIndex=xmlString.indexOf("<Relationships");xmlString=xmlString.replace(xmlString.slice(startIndex),serializer.serializeToString(xml.documentElement)),zip.file("word/_rels/document.xml.rels",xmlString)},Media.updateMediaContent=function(zip,count,_media){let xmlString=zip.file("word/document.xml").asText();xmlString=xmlString.replace(new RegExp(_media[count].oldRelID+'"','g'),_media[count].oldRelID+'_'+count+'"'),zip.file("word/document.xml",xmlString)},Media.copyMediaFiles=function(base,_media,_files){for(const media in _media){const content=_files[_media[media].fileIndex].file(_media[media].oldTarget).asUint8Array();base.file('word/'+_media[media].newTarget,content)}};const bulletsNumbering={};bulletsNumbering.prepareNumbering=function(files){const serializer=new XMLSerializer;files.forEach((zip,index)=>{const xmlBin=zip.file('word/numbering.xml');if(!xmlBin)return;let xmlString=xmlBin.asText();const xml=new DOMParser().parseFromString(xmlString,'text/xml'),nodes=xml.getElementsByTagName('w:abstractNum');for(let i=0;i<nodes.length;i++){const node=nodes[i];if(node.getAttribute){node.setAttribute('w:abstractNumId',node.getAttribute('w:abstractNumId')+index);const pStyles=node.getElementsByTagName('w:pStyle');for(let j=0;j<pStyles.length;j++)pStyles[j].getAttribute&&pStyles[j].setAttribute('w:val',pStyles[j].getAttribute('w:val')+'_'+index);const numStyleLinks=node.getElementsByTagName('w:numStyleLink');for(let j=0;j<numStyleLinks.length;j++)numStyleLinks[j].getAttribute&&numStyleLinks[j].setAttribute('w:val',numStyleLinks[j].getAttribute('w:val')+'_'+index);const styleLinks=node.getElementsByTagName('w:styleLink');for(let j=0;j<styleLinks.length;j++)styleLinks[j].getAttribute&&styleLinks[j].setAttribute('w:val',styleLinks[j].getAttribute('w:val')+'_'+index)}}const numNodes=xml.getElementsByTagName('w:num');for(let i=0;i<numNodes.length;i++){const node=numNodes[i];if(node.getAttribute){node.setAttribute('w:numId',node.getAttribute('w:numId')+index);const absrefID=node.getElementsByTagName('w:abstractNumId');for(let j=0;j<absrefID.length;j++)absrefID[j].getAttribute&&absrefID[j].setAttribute('w:val',absrefID[j].getAttribute('w:val')+index)}}const startIndex=xmlString.indexOf("<w:numbering ");xmlString=xmlString.replace(xmlString.slice(startIndex),serializer.serializeToString(xml.documentElement)),zip.file("word/numbering.xml",xmlString)})},bulletsNumbering.mergeNumbering=function(files,_numbering){files.forEach(zip=>{const xmlBin=zip.file('word/numbering.xml');if(!xmlBin)return;let xmlString=xmlBin.asText();xmlString=xmlString.substring(xmlString.indexOf("<w:abstractNum "),xmlString.indexOf("</w:numbering")),_numbering.push(xmlString)})},bulletsNumbering.generateNumbering=function(zip,_numbering){const xmlBin=zip.file('word/numbering.xml');if(!xmlBin)return;let xmlString=xmlBin.asText();const startIndex=xmlString.indexOf("<w:abstractNum "),endIndex=xmlString.indexOf("</w:numbering>");xmlString=xmlString.replace(xmlString.slice(startIndex,endIndex),_numbering.join('')),zip.file("word/numbering.xml",xmlString)};class DocxMerger{constructor(){this._body=[],this._files=[],this._contentTypes={},this._media={},this._rel={},this._style=[],this._numbering=[]}initialize(options,files){files=files||[],this._pageBreak=void 0!==options.pageBreak?!!options.pageBreak:!0;for(const file of files)this._files.push(new JSZip(file));this._files.length>0&&this.mergeBody(this._files)}insertPageBreak(){this._body.push('<w:p><w:r><w:br w:type="page"/></w:r></w:p>')}mergeBody(files){RelContentType.mergeContentTypes(files,this._contentTypes),Media.prepareMediaFiles(files,this._media),RelContentType.mergeRelations(files,this._rel),bulletsNumbering.prepareNumbering(files),bulletsNumbering.mergeNumbering(files,this._numbering);for(let i=0;i<files.length;i++){Style.prepareStyles(files,i)}Style.mergeStyles(files,this._style),files.forEach((zip,index)=>{let xmlString=zip.file("word/document.xml").asText(),body=xmlString.substring(xmlString.indexOf("<w:body>")+8,xmlString.indexOf("</w:body>"));body.substring(body.lastIndexOf("<w:sectPr"));body=body.substring(0,body.lastIndexOf("<w:sectPr")),this._body.push(body),this._pageBreak&&index<files.length-1&&this.insertPageBreak()})}save(type, postProcessBody){const bodyXml=postProcessBody?postProcessBody(this._body.join('')):this._body.join('');const zip=this._files[0];let xmlString=zip.file("word/document.xml").asText();const startIndex=xmlString.indexOf("<w:body>")+8,endIndex=xmlString.lastIndexOf("<w:sectPr");return xmlString=xmlString.replace(xmlString.slice(startIndex,endIndex),bodyXml),RelContentType.generateContentTypes(zip,this._contentTypes),Media.copyMediaFiles(zip,this._media,this._files),RelContentType.generateRelations(zip,this._rel),bulletsNumbering.generateNumbering(zip,this._numbering),Style.generateStyles(zip,this._style),zip.file("word/document.xml",xmlString),zip.generate({type:type,compression:"DEFLATE",compressionOptions:{level:4}})}}window.DocxMerger=DocxMerger})(window);

    // ====================================================================================
    // 主程序 (UI 交互逻辑)
    // ====================================================================================
    window.addEventListener('load',()=>{lucide.createIcons();initMerger()});function initMerger(){const dropZone=document.getElementById('merge-drop-zone'),fileInput=document.getElementById('merge-file-input'),fileListContainer=document.getElementById('file-list'),filesSection=document.getElementById('merge-files-section'),optionsSection=document.getElementById('options-section'),mergeButton=document.getElementById('merge-button'),buttonText=document.getElementById('merge-button-text'),errorMessage=document.getElementById('merge-error-message'),clearAllBtn=document.getElementById('clear-all-btn'),fontToggle=document.getElementById('font-toggle'),lineSpacingToggle=document.getElementById('line-spacing-toggle'),lineBreakToggle=document.getElementById('line-break-toggle'),pageBreakToggle=document.getElementById('page-break-toggle'),filenameInput=document.getElementById('output-filename');let filesToMerge=[],sortableInstance=null;function handleFiles(files){errorMessage.textContent='';for(const file of files)file.name.endsWith('.docx')?function(file){const reader=new FileReader;reader.onload=e=>{filesToMerge.push({id:'file_'+Date.now()+Math.random(),name:file.name,data:e.target.result}),updateFileList()},reader.readAsArrayBuffer(file)}(file):showError(`文件 "${file.name}" 不是 .docx 格式。`)}function updateFileList(){fileListContainer.innerHTML='',filesToMerge.length>0?(filesSection.classList.remove('hidden'),optionsSection.classList.remove('hidden')):(filesSection.classList.add('hidden'),optionsSection.classList.add('hidden')),mergeButton.disabled=filesToMerge.length<1,buttonText.textContent=filesToMerge.length<1?"请至少上传一个文件":`生成文档`,filesToMerge.forEach((file,index)=>{const item=document.createElement('div');item.className='flex items-center gap-4 bg-slate-50 p-3 rounded-lg border border-slate-200 cursor-grab active:cursor-grabbing hover:shadow-md hover:border-indigo-200 transition-all duration-200 fade-in-up',item.style.animationDelay=`${index*50}ms`,item.dataset.id=file.id,item.innerHTML=`<i data-lucide="grip-vertical" class="h-5 w-5 text-slate-400"></i><i data-lucide="file-text" class="h-6 w-6 text-indigo-500"></i><span class="flex-grow font-medium text-slate-800 truncate">${file.name}</span><button class="remove-btn text-slate-400 hover:text-red-500 transition-colors" data-id="${file.id}"><i data-lucide="x" class="h-5 w-5 pointer-events-none"></i></button>`,fileListContainer.appendChild(item)}),lucide.createIcons(),sortableInstance&&sortableInstance.destroy(),sortableInstance=new Sortable(fileListContainer,{animation:150,ghostClass:'file-list-ghost',onEnd:evt=>{const item=filesToMerge.splice(evt.oldIndex,1)[0];filesToMerge.splice(evt.newIndex,0,item)}}),document.querySelectorAll('.remove-btn').forEach(btn=>btn.addEventListener('click',e=>{filesToMerge=filesToMerge.filter(f=>f.id!==e.currentTarget.dataset.id),updateFileList()}))}function clearAll(){filesToMerge=[],fileInput.value='',updateFileList()}function showError(message){errorMessage.textContent=message}function applyPostProcessing(bodyXml,options){const parser=new DOMParser,serializer=new XMLSerializer,doc=parser.parseFromString(`<w:body xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">${bodyXml}</w:body>`,"text/xml");if(options.removeLineBreaks){doc.querySelectorAll("br:not([w\\:type])").forEach(br=>br.parentNode.removeChild(br))}if(options.removePageBreaks){doc.querySelectorAll('br[w\\:type="page"]').forEach(br=>{const p=br.closest("w\\:p");p&&p.parentNode.removeChild(p)})}if(options.font){doc.querySelectorAll("rPr").forEach(rPr=>{let fontNode=rPr.querySelector("rFonts");fontNode||(fontNode=doc.createElement("w:rFonts"),rPr.appendChild(fontNode)),fontNode.setAttribute("w:ascii","等线"),fontNode.setAttribute("w:hAnsi","等线"),fontNode.setAttribute("w:eastAsia","等线")})}if(options.lineSpacing){doc.querySelectorAll("pPr").forEach(pPr=>{let spacingNode=pPr.querySelector("spacing");spacingNode||(spacingNode=doc.createElement("w:spacing"),pPr.appendChild(spacingNode)),spacingNode.setAttribute("w:line","60"),spacingNode.setAttribute("w:lineRule","auto")})}return doc.documentElement.innerHTML}async function executeMerge(){if(filesToMerge.length<1)return void showError('请至少上传一个文件。');mergeButton.disabled=!0,buttonText.textContent='正在处理...',errorMessage.textContent='';try{const merger=new window.DocxMerger;merger.initialize({pageBreak:filesToMerge.length>1},filesToMerge.map(f=>f.data));const options={font:fontToggle.checked,lineSpacing:lineSpacingToggle.checked,removeLineBreaks:lineBreakToggle.checked,removePageBreaks:pageBreakToggle.checked},processedData=merger.save('blob',body=>applyPostProcessing(body,options)),link=document.createElement('a');link.href=URL.createObjectURL(processedData);let filename=filenameInput.value.trim();filename?filename.endsWith(".docx")||(filename+=".docx"):filename=`processed_${Date.now()}.docx`,link.download=filename,link.click(),URL.revokeObjectURL(link.href),buttonText.textContent='处理成功！'}catch(error){console.error('处理失败:',error),showError('处理过程中发生错误: '+error.message),buttonText.textContent='处理失败'}finally{setTimeout(()=>{mergeButton.disabled=!1,updateFileList()},2e3)}}dropZone.addEventListener('click',()=>fileInput.click()),fileInput.addEventListener('change',e=>handleFiles(e.target.files)),clearAllBtn.addEventListener('click',clearAll),dropZone.addEventListener('dragover',e=>{e.preventDefault(),dropZone.classList.add('border-indigo-500','bg-indigo-50')}),dropZone.addEventListener('dragleave',()=>dropZone.classList.remove('border-indigo-500','bg-indigo-50')),dropZone.addEventListener('drop',e=>{e.preventDefault(),dropZone.classList.remove('border-indigo-500','bg-indigo-50'),handleFiles(e.dataTransfer.files)}),mergeButton.addEventListener('click',executeMerge)}
    </script>
</body>
</html>